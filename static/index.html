<!doctype html>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
	font-family: sans-serif;
	margin: 0;
	padding: 0;
	background-color: #f7f7f7;
	display:flex;
	flex-direction: column;
	align-items: center;
}
		#login-section, #chat-section {
			width: 100%;
			max-width: 600px;
			padding: 1rem;
			box-sizing: border-box;
		}

		input[type="text"] {
			width:100%;
			padding: 0.75rem;
			margin-bottom: 1rem;
			font-size: 1rem;
		}

		button{
			width:100%;
			padding:0.75rem;
			font-size:1rem;
			background-color: #4CAF50;
			color:white;
			border:none;
			border-radius:4px;
			cursor: pointer;
		}

		button:hover{
			background-colorp: #45a049;
		}
		textarea {
			width:100%;
			height: 300px;
			resize:none;
			padding:0.75rem;
			font-size:1rem;
			margin-bottom: 0.5rem;
			box-sizing: border-box;
		}

		@media (max-width:480px) {
			textarea {
				height: 200px;
			}
		}

		<title>realtime-chat</title></head>
	<body>
		<div id="login-section">
			<h3>enter your username</h3>

			<input type="text" id="username" placeholder="Username">
			<button onclick="startChat()">join chat</button>
		</div>


		<div id="chat-section" style="display:none;">
		<h3>websocket chat</h3>

		<textarea id="chat" cols="50" rows="10" readonly></textarea><br>

		<input type="text" id="message" placeholder="type a message..">
		<button onclick="sendMessage()">send</button>
		</div>

		<script>
                let ws;
		let currentUser = "";

		function startChat() {
			const name = document.getElementById("username").value.trim();
			if (!name) return alert("enter a username");

			currentUser = name;

			document.getElementById("login-section").style.display = "none";
			document.getElementById("chat-section").style.display = "block";


			const ws_scheme = location.protocol === "https:" ? "wss" : "ws";
			const ws_url = `${ws_scheme}://${location.host}/ws?user=${encodeURIComponent(name)}`;
			console.log("websocket url:", ws_url);

			ws = new WebSocket(ws_url);

			ws.onmessage = event => {
				const ChatBox =	document.getElementById("chat");
				ChatBox.value += event.data + "\n";

				ChatBox.scrollTop = ChatBox.scrollHeight;

				

			};

			ws.onerror = (event) => {
				alert("websocket error occured");
				console.error("websocket error", event);

		};
	}

			function sendMessage() {
				const input = document.getElementById("message");
				const text = input.value.trim();

				if (!text) return;

				ws.send(text);
				input.value = "";
			}

		

		</script>

	</body>
</html>


